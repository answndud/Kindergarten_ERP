# 2026-02-14 성능 개선 스크립트 (면접/발표용)

## 15초 한 줄 소개

"기능 완성 후 생긴 병목을 수치로 확인하고, N+1 제거 + 집계 쿼리 전환 + 인덱스 튜닝으로 개선해,
동일 시나리오에서 쿼리 수와 응답 시간을 줄인 경험이 있습니다."

## 30초 버전

처음에는 기능 구현을 우선해서 알림장/대시보드 API가 데이터 증가 시 느려질 수 있는 구조였습니다.
그래서 먼저 같은 시나리오로 측정했고, N+1 제거, 집계 쿼리 통합, Redis 토큰 조회 경로 단순화,
인덱스 튜닝까지 단계적으로 적용했습니다.
결과적으로 알림장 목록은 쿼리 수 22 -> 4, 응답 시간 15ms -> 4ms,
대시보드 통계는 쿼리 수 13 -> 10, 응답 시간 14ms -> 2ms로 개선했습니다.

## 1분 버전 (실전 답변)

이 프로젝트는 처음부터 완벽한 성능을 만들기보다,
"문제를 재현하고 근거로 개선한다"는 과정을 포트폴리오로 보여주려고 설계했습니다.

가장 먼저 잡은 병목은 알림장 목록의 읽음 수 조회였습니다.
페이지 내 알림장마다 읽음 정보를 별도로 조회하던 N+1 패턴이 있었고,
읽음 수를 다건 집계 쿼리 1회로 바꿔서 쿼리 수를 22에서 4로 줄였습니다.

다음은 대시보드 통계였습니다.
출석률 계산은 PRESENT/LATE를 각각 세던 방식을 단일 집계로 통합했고,
공지 열람률도 목록 로딩이 아니라 SUM(view_count) 집계로 바꿨습니다.
같은 테스트 시나리오 기준으로 쿼리 수는 13에서 10, 응답 시간은 14ms에서 2ms로 개선됐습니다.

인증 쪽에서는 Redis refresh token 조회 경로를
패턴 검색에서 `refresh:{email}` 단일 키 조회/삭제로 바꿔 O(1) 경로를 만들었고,
운영 중 Redis 부하 리스크를 줄였습니다.

마지막으로 EXPLAIN으로 실행계획을 검증하면서,
ALL/filesort가 나오던 쿼리를 ref/range 기반으로 개선해
코드와 DB 양쪽에서 성능 개선 근거를 확보했습니다.

## 3분 버전 (깊이 질문 대응)

### 1) 어떻게 병목을 찾았는지

먼저 "어디가 느린가"를 감으로 판단하지 않고,
시나리오를 고정한 뒤 쿼리 수와 응답 시간을 함께 측정했습니다.
대상은 사용자 체감이 큰 알림장 목록과 대시보드 통계였습니다.

### 2) 왜 이 순서로 개선했는지

캐시를 먼저 붙이지 않고, 기본 조회 비용을 먼저 낮췄습니다.
N+1 제거 -> 집계 쿼리 통합 -> 인덱스 튜닝 순서로 진행한 이유는
각 단계의 효과를 분리해 설명하기 쉽고 회귀 위험도 낮기 때문입니다.

### 3) 트레이드오프를 어떻게 봤는지

인덱스 추가는 쓰기 비용과 저장공간 증가를 동반합니다.
다만 이 프로젝트는 조회 트래픽이 핵심이어서 read 최적화를 우선했고,
추후에는 slow query log와 실행계획으로 인덱스를 주기적으로 정리할 계획입니다.

## 꼬리 질문 대응 템플릿

### Q1. 왜 캐시보다 N+1 제거를 먼저 했나요?

캐시는 증상 완화이고, N+1은 원인 제거라서 먼저 기본 비용을 줄였습니다.
이후 필요한 구간에만 캐시를 올리는 방식이 유지보수와 디버깅에 유리합니다.

### Q2. 인덱스는 어떤 기준으로 설계했나요?

실제 `where + order by + join` 패턴을 기준으로 복합 인덱스를 설계했고,
EXPLAIN에서 ALL/filesort 제거 여부를 확인했습니다.

### Q3. 성능 수치는 어떻게 신뢰했나요?

동일 시나리오/동일 데이터/동일 환경에서 전후를 비교했고,
테스트 로그에 쿼리 수와 경과 시간을 함께 남겼습니다.

### Q4. 다음 단계는 무엇인가요?

현재는 단일 노드 기준 최적화이고,
다음은 트래픽 시뮬레이션(k6)과 캐시 TTL 정책 검증으로 확장할 계획입니다.

## 실제 수치 요약

- Notepad 목록: queries 22 -> 4, elapsed 15ms -> 4ms
- Dashboard 통계: queries 13 -> 10, elapsed 14ms -> 2ms

## 관련 문서

- `docs/performance-optimization/notepad-readcount-nplusone.md`
- `docs/performance-optimization/dashboard-stats.md`
- `docs/performance-optimization/redis-jwt.md`
- `docs/performance-optimization/index-tuning-dashboard-notepad.md`
- `docs/performance-optimization/portfolio-storytelling-roadmap.md`
